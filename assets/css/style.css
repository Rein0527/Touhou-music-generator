:root{
  /* 新增主題色，整站共用 */
  --accent: #bb71f3;

  /* 既有變數 */
  --bg-dim: 1;            /* 顯示圖片時 → 0；關閉圖片時 → 1 */
  --bg-fit: contain;      /* 預設改成 contain */
  --bg-blur: 0px;         /* 顯示圖片時關閉模糊；關閉背景時改為 8px */
}

/* 背景與舞台 */
html, body {
  height:100%; margin:0; background:#0b0d12; color:#fff;
  font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","Microsoft JhengHei",Arial;
}
.app{ position:relative; min-height:100%; overflow:hidden; }
.bg,.bg-next{
  position:absolute; inset:0;
  background-position:center;
  background-size: var(--bg-fit);
  background-repeat: no-repeat;
  filter: blur(var(--bg-blur)) saturate(1.05) brightness(0.74);
  transform:scale(1.03);
  transition:opacity .8s ease, background-size .2s ease, filter .2s ease;
}
.bg{opacity:1}
.bg-next{opacity:0}
.bg-dim{
  position:absolute; inset:0;
  background:radial-gradient(ellipse at center,rgba(0,0,0,.2),rgba(0,0,0,.62) 58%,rgba(0,0,0,.82));
  opacity: var(--bg-dim);
  transition: opacity .25s ease;
}
.stage{ position:relative; z-index:5; display:grid; place-items:center; min-height:72vh; padding-top:5vh; gap:16px; }
canvas{ width:min(78vmin,1040px); height:min(78vmin,1040px); aspect-ratio:1/1; touch-action:none; }

/* 標題 + 進度條 */
.nowplaying{ width:min(78vmin,1040px); display:grid; gap:6px; }
.title{ font-weight:600; opacity:.95; text-align:center; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.scrub{ display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:12px; }
.time{ font-variant-numeric:tabular-nums; opacity:.95; }
.bar-outer{
  position:relative; height:10px; border-radius:999px;
  background:rgba(255,255,255,.15); overflow:hidden; cursor:pointer;
}
/* 改用 --accent 作為進度色 */
.bar-inner{ position:absolute; inset:0 100% 0 0; background:var(--accent); border-radius:999px; }

/* 播放清單（左側抽屜） */
.playlist-panel{
  position:fixed; top:0; left:-340px; width:340px; height:100%;
  background:rgba(20,20,20,.85); backdrop-filter:blur(10px);
  transition:left .3s ease; z-index:30; display:flex; flex-direction:column;
}
.playlist-panel.open{ left:0; }
.playlist-header{ display:flex; justify-content:space-between; align-items:center; padding:12px; border-bottom:1px solid rgba(255,255,255,.15); }
#playlistItems{ list-style:none; margin:0; padding:0; overflow-y:auto; flex:1; }
#playlistItems li{ padding:10px 14px; cursor:pointer; border-bottom:1px solid rgba(255,255,255,.08); color:#ddd; }
#playlistItems li:hover{ background:rgba(255,255,255,.12); color:#fff; }
#playlistItems li.active{ background:rgba(187,113,243,.25); color:#fff; }

/* 設定（右下角小浮窗） */
.settings-flyout{
  position:fixed; right:16px; bottom:84px; z-index:35;
  width:320px; background:rgba(28,28,32,.92);
  border:1px solid rgba(255,255,255,.12); border-radius:16px;
  backdrop-filter:blur(12px);
  transform:translateY(24px); opacity:0; pointer-events:none;
  transition:transform .22s ease, opacity .22s ease;
}
.settings-flyout.open{ transform:translateY(0); opacity:1; pointer-events:auto; }
.settings-header{ display:flex; justify-content:space-between; align-items:center; padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.12);}
.btn.icon.sm{ width:40px; height:40px; border-radius:50%; font-size:18px; }
.settings-body{ padding:10px 12px 14px; display:flex; flex-direction:column; gap:10px; }
.row{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
.row .sub{ opacity:.9; font-size:12px; }
.sep{ height:1px; background:rgba(255,255,255,.12); margin:4px 0; }
.input{
  flex:1; min-width:0;
  background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18);
  color:#fff; border-radius:10px; padding:8px 10px; outline:none;
}
/* focus 邊框也跟著主題色 */
.input:focus{ border-color:var(--accent); }
.actions{ display:flex; gap:8px; justify-content:flex-end; }
.btn{ appearance:none; border:none; color:#fff;
  background:linear-gradient(180deg,rgba(33,41,54,.65),rgba(18,23,33,.65));
  border-radius:12px; cursor:pointer; user-select:none; transition:all .2s ease; padding:8px 12px;
}
.btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,.2); }
.btn.icon{ width:60px; height:60px; border-radius:50%; font-size:26px; }
.btn.icon:hover,.btn:hover{ background:rgba(255,255,255,.25); transform:translateY(-2px); }
.btn.icon:active,.btn:active{ transform:translateY(2px) scale(.95); background:rgba(255,255,255,.3); }

/* toggle switch */
.switch{ position:relative; display:inline-block; width:46px; height:24px; }
.switch input{ display:none; }
.slider{ position:absolute; cursor:pointer; inset:0; background:#777; transition:.2s; border-radius:24px; }
.slider:before{ content:""; position:absolute; height:18px; width:18px; left:3px; bottom:3px; background:#fff; transition:.2s; border-radius:50%; }
input:checked + .slider{ background:#4caf50; }
input:checked + .slider:before{ transform:translateX(22px); }

/* 下拉選單樣式（修正文字看不到問題） */
.settings-flyout select,
.settings-flyout select.input{
  appearance: none; -webkit-appearance:none; -moz-appearance:none;
  width: 100%;
  padding: 8px 28px 8px 10px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,.18);
  background-color: rgba(255,255,255,.08);
  color: #fff; font-size: 14px; outline: none; line-height: 1.2; cursor: pointer;
  background-image:
    linear-gradient(transparent, transparent),
    url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='white'><path d='M7 10l5 5 5-5z'/></svg>");
  background-repeat:no-repeat;
  background-position:right 10px center;
}
.settings-flyout select option{ background:#1e1e24; color:#fff; }
/* select focus 同步主題色 */
.settings-flyout select:focus{ border-color:var(--accent); }

/* 底部控制列 */
.bar{
  position:fixed; left:0; right:0; bottom:0; z-index:20;
  display:grid; grid-template-columns:1fr auto 1fr;
  align-items:center; padding:10px 20px;
  backdrop-filter:blur(12px) saturate(1.2); background:rgba(255,255,255,.08);
  border-top:1px solid rgba(255,255,255,.15);
}
.bar-left{ display:flex; align-items:center; justify-content:flex-start; }
.bar-center{ display:flex; justify-content:center; align-items:center; gap:40px; }

/* 右側音量 */
.bar-right{ display:flex; justify-content:flex-end; align-items:center; gap:12px; }
.vol{ display:flex; align-items:center; gap:6px; }
.vol input{ width:120px; }

/* 視覺化不負責拖曳 */
canvas{ cursor:default; }

/* 確保下載 SVG 與其他圖示高度一致 */
.icon-download {
  width: 37px;
  height: 26px;
  display: block;
}