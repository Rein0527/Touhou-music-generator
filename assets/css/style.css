:root{
  --bg-fade-ms:850;
  --text:#222; --muted:#666;
  --panel:rgba(255,255,255,0.65);
  --panel-strong:rgba(255,255,255,0.78);
  --border:rgba(0,0,0,0.12);
  --accent:#e8458b; --accent-2:#7aa8ff;
}

html,body{
  height:100%; margin:0; background:#f3f4f6; color:var(--text);
  font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans","PingFang TC","Microsoft JhengHei",Arial;
}
.app{position:relative;min-height:100%;overflow:hidden}

/* 背景層 */
.bg,.bg-next{
  position:absolute; inset:0; background-position:center; background-size:cover;
  filter:blur(10px) saturate(1.05) brightness(.92);
  transform:scale(1.03);
  transition:opacity calc(var(--bg-fade-ms)*1ms) ease;
}
.bg{opacity:1}.bg-next{opacity:0}
.bg-dim{position:absolute; inset:0;
  background:radial-gradient(ellipse at center, rgba(255,255,255,.34), rgba(230,230,230,.68) 58%, rgba(210,210,210,.9));
  pointer-events:none;
}

/* 玻璃舞台 */
.stage{position:relative; z-index:10; display:grid; place-items:center; min-height:72vh; padding-top:5vh;}
.glass-stage{
  width:min(78vmin,1040px); height:min(78vmin,1040px);
  display:grid; place-items:center; border-radius:50%;
  background:linear-gradient(135deg, rgba(255,255,255,.18), rgba(255,255,255,.08));
  backdrop-filter: blur(14px) saturate(1.2);
  -webkit-backdrop-filter: blur(14px) saturate(1.2);
  border:1px solid rgba(255,255,255,.38);
  box-shadow:
    0 12px 32px rgba(0,0,0,.16),
    inset 0 1px 0 rgba(255,255,255,.55),
    inset 0 -1px 0 rgba(255,255,255,.25);
}
canvas{width:92%; height:92%; aspect-ratio:1/1; touch-action:none}

/* 播放列（玻璃） */
.bar{
  position:fixed; left:0; right:0; bottom:0; z-index:20;
  display:flex; justify-content:space-between; align-items:center;
  gap:12px; padding:12px clamp(14px,3vw,24px);
  background:var(--panel); backdrop-filter:blur(12px) saturate(1.1);
  -webkit-backdrop-filter:blur(12px) saturate(1.1);
  border-top:1px solid var(--border);
}
.bar-left,.bar-right{display:flex; align-items:center; gap:10px;}
.controls{display:flex; align-items:center; gap:14px;}

.btn{
  appearance:none; border:1px solid rgba(0,0,0,.15); color:var(--text);
  background:var(--panel-strong);
  padding:10px 12px; border-radius:14px; font-size:14px; cursor:pointer; user-select:none;
  transition:transform .08s ease, box-shadow .12s ease, border-color .12s ease;
  box-shadow:0 6px 20px rgba(0,0,0,.08), 0 0 0 1px rgba(255,255,255,.4) inset;
}
.btn:hover{border-color:rgba(0,0,0,.25); box-shadow:0 8px 24px rgba(0,0,0,.12), 0 0 0 1px rgba(255,255,255,.5) inset}
.btn:active{transform: translateY(2px) scale(.98); box-shadow:0 4px 14px rgba(0,0,0,.16) inset}
.btn.icon{width:48px; height:48px; display:grid; place-items:center; font-size:20px}
.btn.ghost{background:rgba(255,255,255,.35)}

/* 播放鍵下壓手感（切換時微縮放） */
.btn-play{font-weight:700}
.btn-play.tapping{transform:translateY(2px) scale(.98)}

/* ===== 左側抽屜：播放清單 ===== */
.playlist{
  position:fixed; inset:0; z-index:50; display:none;
  background:rgba(0,0,0,.18);
}
.playlist.show{ display:block; }

/* 左側面板本體 */
.playlist .sheet{
  position:absolute; top:0; left:0;
  width:min(360px, 92vw); height:100%;
  background:rgba(255,255,255,.8);
  backdrop-filter: blur(14px) saturate(1.1);
  -webkit-backdrop-filter: blur(14px) saturate(1.1);
  border-right:1px solid var(--border);
  box-shadow: 8px 0 28px rgba(0,0,0,.16);
  overflow:auto;
  transform: translateX(-100%);
  animation: slideIn .22s ease-out forwards;
}
@keyframes slideIn { to { transform: translateX(0); } }

.sheet-head{display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--border)}
.sheet h3{margin:0; font-size:16px}
#trackList{list-style:none; margin:0; padding:0}
#trackList li{
  padding:12px 16px; border-bottom:1px solid rgba(0,0,0,.06); cursor:pointer;
  display:flex; align-items:center; gap:8px; position:relative;
}
#trackList li:hover{background:rgba(0,0,0,.04)}
#trackList li.is-current{color:var(--accent); font-weight:600}
#trackList li.is-current::before{
  content:""; position:absolute; left:0; top:0; bottom:0; width:3px; background:linear-gradient(180deg, var(--accent), var(--accent-2));
}

/* ===== 設定面板（保持中央浮窗玻璃） ===== */
.settings{
  position:fixed; inset:0; z-index:50; display:none;
  align-items:center; justify-content:center;
  background:rgba(0,0,0,.18);
}
.settings.show{display:flex}
.settings .sheet{
  width:min(520px,92vw);
  background:rgba(255,255,255,.8);
  backdrop-filter: blur(14px) saturate(1.1);
  -webkit-backdrop-filter: blur(14px) saturate(1.1);
  border:1px solid var(--border); border-radius:18px;
  box-shadow: 0 12px 28px rgba(0,0,0,.16);
  max-height:85vh; overflow:auto;
}
.form-row{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 14px; border-bottom:1px solid rgba(0,0,0,.06)}
.input{
  width:220px; padding:8px 10px; border-radius:10px; border:1px solid var(--border);
  background:rgba(255,255,255,.9); color:var(--text);
}

/* Toggle switch（左右開關） */
.toggle{display:flex; align-items:center; gap:12px; cursor:pointer; user-select:none}
.toggle .label{font-size:14px}
.toggle input{display:none}
.toggle .track{
  width:54px; height:30px; border-radius:999px; position:relative;
  background:rgba(0,0,0,.2); border:1px solid rgba(0,0,0,.15);
  transition: background .15s ease, border-color .15s ease;
}
.toggle .knob{
  position:absolute; top:2px; left:2px; width:26px; height:26px; border-radius:50%;
  background:#fff; box-shadow:0 2px 8px rgba(0,0,0,.16);
  transition: transform .18s ease;
}
.toggle input:checked + .track{ background:linear-gradient(135deg, #e8458b, #7aa8ff); border-color:transparent }
.toggle input:checked + .track .knob{ transform: translateX(24px) }

/* 響應式微調 */
@media (max-width:600px){
  .btn.icon{width:44px; height:44px}
  .controls{gap:10px}
}
